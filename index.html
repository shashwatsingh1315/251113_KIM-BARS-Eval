<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BARS Assessment - Kimbal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f5f7fa;
            color: #1a1a1a;
        }

        /* Color Palette - Only 4 colors */
        :root {
            --primary: #6366F1;
            --white: #ffffff;
            --gray-light: #f5f7fa;
            --gray-dark: #1a1a1a;
            --gray-text: #64748b;
            --gray-border: #e2e8f0;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:disabled {
            background-color: #cbd5e1;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--gray-text);
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            border: 1px solid var(--gray-border);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background-color: var(--gray-light);
            color: var(--gray-dark);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--gray-border);
        }

        .card-small {
            background: white;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--gray-border);
        }

        .screen {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Progress Bar */
        .progress-bar-track {
            background: var(--gray-border);
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            background: var(--primary);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        /* Drag & Drop */
        .drop-zone {
            border: 2px dashed var(--gray-border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .drop-zone:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.03);
        }

        .drop-zone.drag-over {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.08);
        }

        /* Checkbox */
        .checkbox-item {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-item label {
            cursor: pointer;
            flex: 1;
        }

        /* Radio */
        .radio-item {
            position: relative;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            border: 1px solid var(--gray-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-item:hover {
            background: var(--gray-light);
            border-color: var(--primary);
        }

        .radio-item input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
            margin-top: 4px;
            flex-shrink: 0;
        }

        .radio-item input[type="radio"]:checked + .radio-label {
            color: var(--gray-dark);
            font-weight: 600;
        }

        .radio-label {
            cursor: pointer;
            flex: 1;
        }

        .radio-label-title {
            display: block;
            font-weight: 600;
            color: var(--gray-dark);
            margin-bottom: 4px;
        }

        .radio-label-desc {
            display: block;
            font-size: 13px;
            color: var(--gray-text);
            line-height: 1.4;
        }

        /* Text Input */
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-border);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: var(--gray-dark);
            transition: all 0.2s ease;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Typography */
        h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--gray-dark);
            line-height: 1.2;
        }

        h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-dark);
            margin-bottom: 8px;
        }

        h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-dark);
        }

        h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-dark);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        p {
            font-size: 14px;
            color: var(--gray-text);
            line-height: 1.6;
        }

        label {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-dark);
            display: block;
            margin-bottom: 8px;
        }

        /* Parameter Grid */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 16px;
        }

        @media (max-width: 768px) {
            .param-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Parameter Card */
        .param-card {
            background: white;
            border: 2px solid var(--gray-border);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .param-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }

        .param-card.selected {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.02);
        }

        .param-card-title {
            font-weight: 600;
            color: var(--gray-dark);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .param-card-desc {
            font-size: 13px;
            color: var(--gray-text);
            line-height: 1.4;
        }

        /* Question Box */
        .question-box {
            background: rgba(99, 102, 241, 0.05);
            border-left: 4px solid var(--primary);
            padding: 16px;
            border-radius: 4px;
            margin: 20px 0;
        }

        .question-box-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--primary);
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: block;
        }

        .question-box-text {
            font-size: 15px;
            font-weight: 500;
            color: var(--gray-dark);
            line-height: 1.6;
        }

        /* Level Reference Box */
        .level-reference {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .level-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        @media (max-width: 1024px) {
            .level-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .level-grid {
                grid-template-columns: 1fr;
            }
        }

        .level-item {
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--gray-border);
        }

        .level-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
            background: var(--primary);
            color: white;
        }

        .level-content-title {
            font-weight: 700;
            color: var(--gray-dark);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .level-content-desc {
            font-size: 13px;
            color: var(--gray-text);
            line-height: 1.6;
        }

        /* STAR Fields */
        .star-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .star-grid {
                grid-template-columns: 1fr;
            }
        }

        .star-field {
            display: flex;
            flex-direction: column;
        }

        .star-field label {
            margin-bottom: 8px;
        }

        .star-field textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Score Card */
        .score-card {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .score-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .score-card-title {
            font-weight: 600;
            color: var(--gray-dark);
            font-size: 14px;
        }

        .score-card-value {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 12px;
        }

        /* Summary Box */
        .summary-box {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }

        .summary-score {
            font-size: 48px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .summary-score-label {
            font-size: 13px;
            color: var(--gray-text);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .recommendation-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 13px;
            background: var(--primary);
            color: white;
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            margin-top: 32px;
        }

        .progress-info {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-text);
        }

        /* Response Item */
        .response-item {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .response-item-title {
            font-weight: 600;
            color: var(--gray-dark);
            font-size: 15px;
            margin-bottom: 12px;
        }

        .response-item-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .response-item-row {
                grid-template-columns: 1fr;
            }
        }

        .response-item-row:last-child {
            margin-bottom: 0;
        }

        .response-field-label {
            font-weight: 600;
            color: var(--gray-text);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .response-field-value {
            color: var(--gray-dark);
            line-height: 1.5;
        }

        /* Header */
        .app-header {
            background: white;
            border-bottom: 1px solid var(--gray-border);
            padding: 16px 0;
            margin-bottom: 32px;
        }

        .app-header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .app-header h1 {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .app-header p {
            font-size: 13px;
            color: var(--gray-text);
        }

        /* Container */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px 32px;
        }

        /* Error Message */
        .error-message {
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            color: #991b1b;
            font-size: 13px;
            line-height: 1.5;
        }

        .error-message.hidden {
            display: none;
        }

        /* Info Box */
        .info-box {
            background: rgba(99, 102, 241, 0.05);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .info-box-title {
            font-weight: 600;
            color: var(--primary);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .info-box-text {
            font-size: 13px;
            color: var(--gray-text);
            line-height: 1.5;
        }

        .info-box-list {
            list-style: none;
            margin: 8px 0 0 0;
            padding: 0;
        }

        .info-box-list li {
            font-size: 13px;
            color: var(--gray-text);
            margin: 6px 0;
            padding-left: 20px;
            position: relative;
        }

        .info-box-list li:before {
            content: "â€¢";
            position: absolute;
            left: 8px;
            color: var(--primary);
            font-weight: 700;
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }

            body {
                background: white;
            }

            .card {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid var(--gray-border);
            }

            .response-item {
                page-break-inside: avoid;
            }

            .nav-buttons {
                display: none;
            }

            .app-header {
                border: none;
                margin-bottom: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <div class="app-header">
            <div class="app-header-content">
                <h1>BARS Assessment</h1>
                <p>Kimbal Evaluation</p>
            </div>
        </div>

        <!-- Main Container -->
        <div class="app-container">
            <!-- Screen 1: Upload -->
            <div id="screen-upload" class="screen">
                <div class="card" style="max-width: 900px; margin: 0 auto;">
                    <!-- Header Section -->
                    <div style="margin-bottom: 40px;">
                        <h2 style="margin-bottom: 12px;">Upload Assessment Parameters</h2>
                        <p style="font-size: 15px; color: var(--gray-text); line-height: 1.6;">Start by uploading a CSV file containing your assessment parameters. Each parameter will include interview questions and BARS level descriptions (1-4) for evaluation.</p>
                    </div>

                    <!-- Two Column Layout -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px;">
                        <!-- Left Column: Upload Area -->
                        <div>
                            <div style="margin-bottom: 16px;">
                                <h4 style="color: var(--primary); margin-bottom: 12px;">Step 1: Upload Your File</h4>
                            </div>

                            <!-- Drop Zone -->
                            <div class="drop-zone no-print" id="drop-zone" style="padding: 60px 24px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <div style="margin-bottom: 16px;">
                                    <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--primary); opacity: 0.7;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                </div>
                                <p style="font-weight: 600; color: var(--gray-dark); margin-bottom: 8px; font-size: 15px;">Drag CSV file here</p>
                                <p style="font-size: 13px; color: var(--gray-text); margin-bottom: 16px;">or click to browse</p>
                                <button class="btn-primary" id="browse-btn" style="font-size: 13px;">Choose File</button>
                                <input type="file" id="file-input" accept=".csv" style="display: none;">
                            </div>

                            <!-- Error Message -->
                            <div id="error-message" class="error-message hidden" style="margin-top: 16px;"></div>

                            <!-- Template Button -->
                            <button class="btn-secondary" id="download-template" style="width: 100%; margin-top: 20px; border: 1px solid var(--gray-border); background: var(--white);">
                                <span style="margin-right: 8px;">ðŸ“¥</span> Download Sample Template
                            </button>
                        </div>

                        <!-- Right Column: Requirements -->
                        <div>
                            <div style="margin-bottom: 16px;">
                                <h4 style="color: var(--primary); margin-bottom: 12px;">Step 2: File Format</h4>
                            </div>

                            <!-- Clean Requirements Layout -->
                            <div style="background: var(--gray-light); border-radius: 12px; padding: 24px; border-left: 4px solid var(--primary);">
                                <p style="font-size: 13px; color: var(--gray-text); margin-bottom: 20px; line-height: 1.6;">Your CSV file must contain exactly <strong style="color: var(--gray-dark);">7 columns</strong> in this order:</p>
                                
                                <!-- Column List -->
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                                        <div style="width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;">1</div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-dark); font-size: 13px;">Parameter Name</div>
                                            <div style="font-size: 12px; color: var(--gray-text); margin-top: 2px;">e.g., Critical Thinking</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                                        <div style="width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;">2</div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-dark); font-size: 13px;">Parameter Description</div>
                                            <div style="font-size: 12px; color: var(--gray-text); margin-top: 2px;">Brief details about the parameter</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                                        <div style="width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;">3</div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-dark); font-size: 13px;">Interview Question</div>
                                            <div style="font-size: 12px; color: var(--gray-text); margin-top: 2px;">Question to ask the candidate</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                                        <div style="width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;">4</div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-dark); font-size: 13px;">Level 1: Needs Improvement</div>
                                            <div style="font-size: 12px; color: var(--gray-text); margin-top: 2px;">Description for rating level 1</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                                        <div style="width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;">5</div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-dark); font-size: 13px;">Level 2: Meets Expectations</div>
                                            <div style="font-size: 12px; color: var(--gray-text); margin-top: 2px;">Description for rating level 2</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                                        <div style="width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;">6</div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-dark); font-size: 13px;">Level 3: Exceeds Expectations</div>
                                            <div style="font-size: 12px; color: var(--gray-text); margin-top: 2px;">Description for rating level 3</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                                        <div style="width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0;">7</div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-dark); font-size: 13px;">Level 4: Outstanding</div>
                                            <div style="font-size: 12px; color: var(--gray-text); margin-top: 2px;">Description for rating level 4</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section (Hidden by default) -->
                    <div id="preview-section" style="display: none; margin-top: 40px; padding-top: 40px; border-top: 1px solid var(--gray-border);">
                        <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                            <span style="width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">âœ“</span>
                            File Loaded Successfully
                        </h3>
                        <div style="background: var(--gray-light); border-radius: 12px; padding: 20px; margin-bottom: 24px; border-left: 4px solid var(--primary);">
                            <div style="color: var(--gray-text); margin-bottom: 4px; font-size: 13px; font-weight: 600;">PARAMETERS READY</div>
                            <div id="preview-count" style="font-size: 16px; font-weight: 700; color: var(--primary);">Loading...</div>
                        </div>
                        <div style="background: var(--gray-light); border-radius: 12px; padding: 20px; margin-bottom: 24px; overflow-x: auto;">
                            <div id="preview-table"></div>
                        </div>
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button class="btn-secondary" id="change-file">Change File</button>
                            <button class="btn-primary" id="continue-btn">Continue to Selection</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Screen 2: Parameter Selection -->
            <div id="screen-selection" class="screen hidden">
                <div class="card" style="max-width: 1200px; margin: 0 auto;">
                    <h2>Select Parameters</h2>
                    <p style="margin-top: 8px; margin-bottom: 24px;">Choose the parameters you'd like to evaluate for this candidate.</p>

                    <!-- Candidate Name -->
                    <div style="margin-bottom: 24px;">
                        <label for="candidate-name">Candidate Name (Optional)</label>
                        <input type="text" id="candidate-name" placeholder="Enter candidate's name">
                    </div>

                    <!-- Parameters Grid -->
                    <div class="param-grid" id="params-container"></div>

                    <!-- Error Message -->
                    <div id="selection-error" class="error-message hidden" style="margin-top: 24px;">Please select at least one parameter to continue.</div>

                    <!-- Navigation -->
                    <div class="nav-buttons">
                        <button class="btn-secondary" id="back-to-upload">Back</button>
                        <button class="btn-primary" id="start-interview">Start Assessment</button>
                    </div>
                </div>
            </div>

            <!-- Screen 3: Interview Phase -->
            <div id="screen-interview" class="screen hidden">
                <div class="card" style="max-width: 900px; margin: 0 auto;">
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <div>
                            <h2>Interview Phase</h2>
                            <p style="margin-top: 4px;">Pass 1: Conducting the Interview</p>
                        </div>
                        <div class="progress-info" id="interview-progress-text">1 of 5</div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-bar-track">
                        <div class="progress-bar-fill" id="interview-progress-bar" style="width: 20%;"></div>
                    </div>

                    <!-- Content -->
                    <div style="margin-top: 32px;">
                        <!-- Parameter Name -->
                        <h3 id="interview-param-name">Parameter Name</h3>
                        <p id="interview-param-desc" style="margin-top: 8px; margin-bottom: 24px;">Parameter description will appear here.</p>

                        <!-- Question Box -->
                        <div class="question-box">
                            <span class="question-box-label">Interview Question</span>
                            <div class="question-box-text" id="interview-question">What is your example question?</div>
                        </div>

                        <!-- STAR Fields -->
                        <div style="background: rgba(99, 102, 241, 0.04); border-left: 4px solid var(--primary); padding: 16px; border-radius: 4px; margin: 24px 0;">
                            <h4 style="margin-bottom: 8px; color: var(--primary);">STEP 1: Take Notes Using STAR Method</h4>
                            <p style="font-size: 13px; color: var(--gray-text); margin-bottom: 0;">Document the candidate's response by taking notes in each section below. These notes will help you evaluate their performance against the BARS levels.</p>
                        </div>

                        <div class="star-grid">
                            <div class="star-field">
                                <label for="situation">Situation</label>
                                <textarea id="situation" placeholder="Describe the situation..." data-field="situation"></textarea>
                            </div>
                            <div class="star-field">
                                <label for="task">Task</label>
                                <textarea id="task" placeholder="What was the task..." data-field="task"></textarea>
                            </div>
                            <div class="star-field">
                                <label for="action">Action</label>
                                <textarea id="action" placeholder="What action was taken..." data-field="action"></textarea>
                            </div>
                            <div class="star-field">
                                <label for="result">Result</label>
                                <textarea id="result" placeholder="What was the result..." data-field="result"></textarea>
                            </div>
                        </div>

                        <!-- BARS Levels Reference -->
                        <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid var(--gray-border);">
                            <h4 style="margin-bottom: 8px; color: var(--primary);">STEP 2: BARS Levels Reference (For Your Review)</h4>
                            <p style="font-size: 13px; color: var(--gray-text); margin-bottom: 20px;">Use these level definitions as a reference while assessing the candidate's response. You will rate them against these levels in the next phase.</p>
                            <div class="level-grid" id="interview-levels"></div>
                        </div>
                    </div>
                    </div>

                    <!-- Navigation -->
                    <div class="nav-buttons">
                        <button class="btn-secondary" id="interview-prev" disabled>Previous</button>
                        <button class="btn-primary" id="interview-next">Next Parameter</button>
                    </div>
                </div>
            </div>

            <!-- Screen 4: Grading Phase -->
            <div id="screen-grading" class="screen hidden">
                <div class="card" style="max-width: 900px; margin: 0 auto;">
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <div>
                            <h2>Grading Phase</h2>
                            <p style="margin-top: 4px;">Pass 2: Reviewing and Rating Performance</p>
                        </div>
                        <div class="progress-info" id="grading-progress-text">1 of 5</div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-bar-track">
                        <div class="progress-bar-fill" id="grading-progress-bar" style="width: 20%;"></div>
                    </div>

                    <!-- Content -->
                    <div style="margin-top: 32px;">
                        <!-- Parameter Name -->
                        <h3 id="grading-param-name">Parameter Name</h3>
                        <p id="grading-param-desc" style="margin-top: 8px; margin-bottom: 24px;">Parameter description will appear here.</p>

                        <!-- Question Box -->
                        <div class="question-box">
                            <span class="question-box-label">Question Asked</span>
                            <div class="question-box-text" id="grading-question">Question will appear here.</div>
                        </div>

                        <!-- Review Notes -->
                        <div>
                            <h4 style="margin-bottom: 12px;">Your Interview Notes</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; background: var(--gray-light); padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                                <div>
                                    <div style="font-size: 12px; font-weight: 600; color: var(--gray-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Situation</div>
                                    <div style="font-size: 13px; color: var(--gray-dark); line-height: 1.5;" id="review-situation">-</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; font-weight: 600; color: var(--gray-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Task</div>
                                    <div style="font-size: 13px; color: var(--gray-dark); line-height: 1.5;" id="review-task">-</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; font-weight: 600; color: var(--gray-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Action</div>
                                    <div style="font-size: 13px; color: var(--gray-dark); line-height: 1.5;" id="review-action">-</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; font-weight: 600; color: var(--gray-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Result</div>
                                    <div style="font-size: 13px; color: var(--gray-dark); line-height: 1.5;" id="review-result">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- Rating Selection -->
                        <div>
                            <div style="background: rgba(99, 102, 241, 0.04); border-left: 4px solid var(--primary); padding: 16px; border-radius: 4px; margin: 24px 0;">
                                <h4 style="margin-bottom: 8px; color: var(--primary);">STEP 2: Select Your Rating</h4>
                                <p style="font-size: 13px; color: var(--gray-text); margin-bottom: 0;\">Based on the candidate's response and your notes above, select the rating that best describes their performance level. Rate them on the 4-level scale below.</p>
                            </div>
                            <div id="rating-error" class="error-message hidden" style="margin-bottom: 16px;">Please select a rating before proceeding.</div>
                            <div id="grading-ratings" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;"></div><\n>                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="nav-buttons">
                        <button class="btn-secondary" id="grading-prev" disabled>Previous</button>
                        <button class="btn-primary" id="grading-next">Next Parameter</button>
                    </div>
                </div>
            </div>

            <!-- Screen 5: Results -->
            <div id="screen-results" class="screen hidden">
                <div class="card" style="max-width: 900px; margin: 0 auto;">
                    <h2>Assessment Results</h2>
                    <p style="margin-top: 8px; margin-bottom: 24px;">Kimbal Evaluation</p>

                    <!-- Summary Box -->
                    <div class="summary-box">
                        <div class="summary-score-label">Overall Score</div>
                        <div class="summary-score" id="results-score">3.5</div>
                        <div class="recommendation-badge" id="results-recommendation">Strong Hire</div>
                    </div>

                    <!-- Candidate Info -->
                    <div style="background: var(--gray-light); border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                        <div style="font-size: 13px; color: var(--gray-text); margin-bottom: 4px;">CANDIDATE</div>
                        <div style="font-weight: 600; color: var(--gray-dark); font-size: 15px;" id="results-candidate">Unnamed Candidate</div>
                    </div>

                    <!-- Scores -->
                    <div style="margin-bottom: 32px;">
                        <h3 style="margin-bottom: 16px;">Parameter Scores</h3>
                        <div id="results-scores"></div>
                    </div>

                    <!-- Detailed Responses -->
                    <div style="margin-bottom: 32px;">
                        <h3 style="margin-bottom: 16px;">Detailed Responses</h3>
                        <div id="results-responses"></div>
                    </div>

                    <!-- Navigation -->
                    <div class="nav-buttons">
                        <button class="btn-secondary" id="restart-btn">Start New Assessment</button>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn-secondary no-print" id="print-btn">Print Results</button>
                            <button class="btn-primary" id="pdf-btn">Save as PDF</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State Management
        const state = {
            parameters: [],
            selectedParams: [],
            candidateName: '',
            currentIndex: 0,
            starNotes: {},
            ratings: {}
        };

        // DOM Elements
        const screens = {
            upload: document.getElementById('screen-upload'),
            selection: document.getElementById('screen-selection'),
            interview: document.getElementById('screen-interview'),
            grading: document.getElementById('screen-grading'),
            results: document.getElementById('screen-results')
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            setupFileUpload();
            setupEventListeners();
        }

        function setupFileUpload() {
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const browseBtn = document.getElementById('browse-btn');
            const downloadTemplate = document.getElementById('download-template');
            const changeFile = document.getElementById('change-file');
            const continueBtn = document.getElementById('continue-btn');

            browseBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                handleFile(e.dataTransfer.files[0]);
            });

            downloadTemplate.addEventListener('click', downloadSampleCSV);
            changeFile.addEventListener('click', resetUpload);
            continueBtn.addEventListener('click', () => showScreen('selection'));
        }

        function setupEventListeners() {
            document.getElementById('back-to-upload').addEventListener('click', resetUpload);
            document.getElementById('start-interview').addEventListener('click', startInterview);
            document.getElementById('interview-prev').addEventListener('click', prevInterview);
            document.getElementById('interview-next').addEventListener('click', nextInterview);
            document.getElementById('grading-prev').addEventListener('click', prevGrading);
            document.getElementById('grading-next').addEventListener('click', nextGrading);
            document.getElementById('restart-btn').addEventListener('click', restart);
            document.getElementById('print-btn').addEventListener('click', printResults);
            document.getElementById('pdf-btn').addEventListener('click', savePDF);
        }

        function handleFile(file) {
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n').map(l => l.trim()).filter(l => l);
                    
                    if (lines.length < 2) {
                        showError('CSV file is empty');
                        return;
                    }

                    const headers = parseCSVLine(lines[0]);
                    if (headers.length !== 7) {
                        showError(`Invalid CSV format. Expected 7 columns, found ${headers.length}`);
                        return;
                    }

                    const params = [];
                    for (let i = 1; i < lines.length; i++) {
                        const values = parseCSVLine(lines[i]);
                        if (values.length === 7 && values[0]) {
                            params.push({
                                name: values[0],
                                description: values[1],
                                question: values[2],
                                level1: values[3],
                                level2: values[4],
                                level3: values[5],
                                level4: values[6]
                            });
                        }
                    }

                    if (params.length === 0) {
                        showError('No valid parameters found in CSV');
                        return;
                    }

                    state.parameters = params;
                    showPreview();
                    hideError();
                } catch (error) {
                    showError('Error parsing CSV: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const next = line[i + 1];

                if (char === '"') {
                    if (inQuotes && next === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function showPreview() {
            const count = state.parameters.length;
            document.getElementById('preview-count').textContent = `${count} parameter${count !== 1 ? 's' : ''} loaded`;

            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 13px;">';
            html += '<thead><tr style="border-bottom: 1px solid var(--gray-border); text-align: left;">';
            html += '<th style="padding: 8px; font-weight: 600; color: var(--gray-dark);">Parameter</th>';
            html += '<th style="padding: 8px; font-weight: 600; color: var(--gray-dark);">Description</th>';
            html += '</tr></thead><tbody>';

            state.parameters.slice(0, 5).forEach(p => {
                html += `<tr style="border-bottom: 1px solid var(--gray-border);"><td style="padding: 8px; color: var(--gray-dark);">${escapeHtml(p.name)}</td><td style="padding: 8px; color: var(--gray-text);">${escapeHtml(p.description.substring(0, 50))}${p.description.length > 50 ? '...' : ''}</td></tr>`;
            });

            html += '</tbody></table>';
            document.getElementById('preview-table').innerHTML = html;
            document.getElementById('preview-section').style.display = 'block';
        }

        function downloadSampleCSV() {
            const csv = `"Parameter","Details & Write-up","Questions to Ask (craft and probe)","Level 1: Basic","Level 2: Intermediate","Level 3: Proficient","Level 4: Expert"
"Together we create magic! â†’ Sensitivity to stakeholder needs","Understands and integrates customer, vendor, colleague, and societal expectations into day-to-day choices and strategy; adapts communication and follow-through to context.","1) Describe a recent situation where two stakeholder groups had conflicting needsâ€”what trade-off did you make and why? 2) How did you change your communication for each audience? 3) What feedback did you collect and how did it alter your plan?","Listens when concerns are raised but inconsistent follow-through; communication style unchanged across audiences.","Acknowledges perspectives; accommodates reasonable requests; sometimes adjusts approach based on feedback.","Maintains regular dialogue to surface deeper needs; actively seeks and applies feedback for mutual benefit.","Consistently integrates stakeholder interests into decisions/strategy; mentors others to solicit and act on stakeholder feedback."
"Together we create magic! â†’ Transparent knowledge sharing","Builds trust and velocity by openly sharing insights, lessons, artifacts; creates channels that enable bidirectional knowledge flow.","1) What reusable insight or artifact did you share in the last month? 2) Where do teammates find it? 3) How did you encourage others to contribute back?","Shares only when prompted; perceived as protective of expertise.","Shares relevant updates/resources when directly applicable; responds positively to requests.","Proactively initiates best-practice exchanges; creates space for othersâ€™ perspectives.","Acts as cross-team â€œknowledge hubâ€; champions systems (forums, shared docs) that institutionalize open learning."
"Together we create magic! â†’ Acknowledges learning milestones","Normalizes learning by celebrating wins, openly discussing failures, and extracting explicit takeaways; rewards effort, not just outcomes.","1) What small win did you recognize recently and how? 2) Describe a failure you debriefedâ€”what was learned, what changed? 3) How do you ensure effort is seen and rewarded?","Focus on task completion; moves past wins/failures without reflection.","Recognizes milestones when prompted; occasionally shares takeaways.","Routinely celebrates successes; invites open discussion of failures; encourages learning from mistakes.","Treats successes and setbacks as engines for growth; mentors others to value effort and learning equally with results."
"Passionate Go-getters â†’ Ambitious goals & initiative","Sets/stretch goals aligned to business impact; takes responsibility beyond formal scope; drives outcomes.","1) What was your last stretch goal and why was it bold? 2) What did you initiate that wasnâ€™t assigned? 3) How did it change a key metric?","Completes assigned work; avoids additional scope unless asked.","Sets personal goals aligned to team; volunteers occasionally.","Regularly sets stretch goals; identifies and acts on opportunities beyond role, owns results.","Champions bold, high-impact goals tied to strategy; leads org-benefit initiatives and inspires others."
"Passionate Go-getters â†’ Engagement under setbacks","Sustains energy, problem-solving, and team morale through ambiguity, pressure, and failure.","1) Describe a tough phaseâ€”what did you do to keep progress and morale? 2) What rituals/tools keep you engaged during headwinds?","Shows frustration/detachment; needs close supervision during setbacks.","Performs core responsibilities; needs support to regain focus.","Maintains productivity and positive attitude; engages in problem-solving; supports team morale.","Sustains high engagement and composure during prolonged setbacks; models resilience and helps the team navigate positively."
"Passionate Go-getters â†’ Advocates company values","Communicates mission, values, achievements with visible energy; builds pride and belonging in and beyond the company.","1) When did you last promote our values externally? 2) What story do you use to illustrate our culture? 3) How do you tailor the message by audience?","Rarely speaks about values or achievements; appears indifferent.","Shares positives when prompted; polite enthusiasm.","Speaks passionately about mission/values in internal & external forums; shares vivid success stories.","Uses every forum to amplify culture/values; creates emotionally engaging environments that build pride/belonging."
"Best Talent Only â†’ Growth mindset & learning","Pursues and applies new skills; converts learning into visible improvement; supports othersâ€™ development.","1) Which skill did you acquire in the last quarter and where has it changed your work? 2) What learning plan do you own for the next 90 days? 3) How have you enabled a peerâ€™s learning?","Relies on existing knowledge; treats learning as obligation.","Applies some new learning inconsistently; growth is reactive.","Regularly applies new skills; takes ownership of development.","Translates learning into innovation and measurable improvements; inspires/supports othersâ€™ learning journeys."
"Best Talent Only â†’ Outcome focus amid ambiguity","Maintains results orientation; reframes uncertainty into experiments and decisions; adapts plans without losing objectives.","1) Describe a time plans changed mid-streamâ€”what outcome did you preserve and how? 2) What signals told you to pivot?","Performance affected by confusion; loses track when plans change.","Works toward goals but momentum dips during change; needs help to reprioritize.","Treats ambiguity with a solutions mindset; adapts plans and methods while staying result-focused.","Anticipates change; confidently reorients and guides others to remain outcome-focused."
"Best Talent Only â†’ Develops others (potential & gaps)","Spots strengths/aspirations; gives candid, frequent feedback; creates coaching and growth opportunities.","1) Who are your top potential bets and why? 2) What feedback did you give last week and what follow-up exists? 3) Which opportunities map to each personâ€™s gap?","Focus on current output; avoids developmental feedback.","Acknowledges obvious potential; provides ad-hoc support when asked.","Proactively observes strengths/gaps; delivers regular feedback and aligned opportunities/coaching.","Builds personalized development plans; champions growth beyond current role; serves as mentor/talent advocate."
"Team of Equals â†’ Fairness & inclusion","Demonstrates equity across religion, gender, region, age, role; invites diverse perspectives; ensures equal access.","1) How did you ensure equal participation in your last meeting? 2) What decision improved inclusion and how do you measure it?","Operates on stereotypes; avoids engaging across differences.","Sometimes biased/unbalanced participation; needs reminders.","Fair and stereotype-free behavior; welcomes diverse viewpoints; collaborates inclusively.","Proactively builds an inclusive culture; mentors others; champions diversity initiatives."
"Team of Equals â†’ Feedback across hierarchies","Gives and receives feedback respectfully and often, regardless of relationship; focuses on behavior and outcomes.","1) Share a hard feedback you gave upward; what changed? 2) Describe feedback you received from a junior and how you acted.","Avoids, or gives vague/critical feedback; rejects feedback from lower hierarchy.","Gives feedback inconsistently; accepts feedback from trusted sources; sometimes defensive.","Gives behavior-focused, respectful feedback; receives feedback with openness and improvement.","Normalizes bidirectional feedback across all levels; models high emotional intelligence; fosters continuous improvement culture."
"Team of Equals â†’ Constructive challenge","Questions processes/assumptions to improve efficiency/effectiveness; proposes alternatives; enables safe dissent.","1) Which entrenched process did you challenge and what better option did you propose? 2) How do you invite dissent on your team?","Accepts flawed status quo; hesitates to question authority/peers.","Occasionally questions; may raise concerns without alternatives; discomfort challenging authority.","Thoughtfully challenges with practical improvements; engages respectfully despite differences.","Consistently challenges long-standing assumptions; leads change; mentors others to question constructively; creates safe debate."
"Always working on our next best â†’ Smart risk & experimentation","Takes calculated risks; runs experiments; treats failure as data; scales what works.","1) What experiment failed recently and what did you change as a result? 2) How do you bound downside when you try something new?","Avoids risk/experimentation; clings to familiar methods; discourages others.","Attempts low-stakes experiments; needs reassurance to try new approaches.","Willingly explores new approaches, even with stakes; supports others; resilient when things fail.","Initiates bold, well-bounded bets under uncertainty; builds a culture of fearless iteration and learning."
"Always working on our next best â†’ Creative ideation","Generates original, high-value ideas; applies creativity to processes/products; creates forums to ideate.","1) What non-obvious solution did you propose this quarter? 2) How do you structure team brainstorming to avoid groupthink?","Rarely suggests new ideas; resists creative change.","Occasionally proposes ideas within familiar boundaries; needs prompting.","Regularly produces original solutions beyond standard approaches; improves processes/products.","Repeatedly delivers breakthrough ideas with significant value; actively builds mechanisms for creativity across the org."
"Always working on our next best â†’ Long-term, far-sighted","Makes decisions with long-term implications in view; anticipates trends/risks; aligns to strategy.","1) What 2â€“3 long-range bets are you progressing and how do they map to strategy? 2) Which future risks did you pre-empt and how?","Optimizes for immediate needs; low awareness of long-term context.","Sometimes considers long-term but defaults to near-term tasks.","Usually plans with clear view of long-term implications; weighs risks/benefits.","Consistently aligns choices to long-term goals; anticipates trends/risks; guides others to adopt long-term perspective."
"Own it like a Boss! â†’ Stewardship of resources","Treats time, budget, tools as personal assets; minimizes waste; maximizes impact per unit resource.","1) How did you improve cost/time efficiency last cycle and by how much? 2) What trade-offs did you make to protect quality?","Waits for instructions; little concern for waste/inefficiency.","Uses resources responsibly with reminders; notices inefficiencies but acts reactively.","Proactively optimizes time/budget/resources; delivers high-quality with minimal waste.","Raises org bar on stewardship; coaches others; consistently balances cost, time, and impact at scale."
"Own it like a Boss! â†’ Commercial & market acumen (incl. P&L)","Understands industry trends, customer needs, competitors; makes decisions with P&L impact (revenue, cost, profitability).","1) Which market shift affected your roadmap most and how did you respond? 2) Quantify a decision you made with explicit P&L impact.","Low awareness of market/competition/customer; no P&L lens.","Aware but applies inconsistently; weak financial focus.","Keeps current on trends and competitors; factors revenue/cost/profit into decisions.","Anticipates market shifts; makes decisions with clear P&L impact; teaches others to think commercially."
"Own it like a Boss! â†’ Ownership of outcomes","Owns successes and failures; credits team; treats failures as learning; drives transparent post-mortems.","1) Describe a failure you owned publiclyâ€”what changed afterward? 2) How do you distribute credit on wins?","Takes credit for wins; blames others or externals for mistakes; avoids owning negatives.","Admits minor/obvious faults when prompted; rationalizes failures at times.","Openly owns mistakes; shares credit for success; uses failures as learning.","Publicly owns outcomes with humility; fosters open dialogue on success/failure to drive team growth."`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bars_template.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function renderParameterSelection() {
            const container = document.getElementById('params-container');
            container.innerHTML = '';

            state.parameters.forEach((p, i) => {
                const div = document.createElement('div');
                div.className = 'param-card';
                div.innerHTML = `
                    <div style="display: flex; gap: 12px;">
                        <input type="checkbox" data-index="${i}" class="param-checkbox" style="margin-top: 2px;">
                        <div style="flex: 1;">
                            <div class="param-card-title">${escapeHtml(p.name)}</div>
                            <div class="param-card-desc">${escapeHtml(p.description)}</div>
                        </div>
                    </div>
                `;

                const checkbox = div.querySelector('.param-checkbox');
                checkbox.addEventListener('change', (e) => {
                    const idx = parseInt(e.target.dataset.index);
                    if (e.target.checked) {
                        if (!state.selectedParams.includes(idx)) state.selectedParams.push(idx);
                        div.classList.add('selected');
                    } else {
                        state.selectedParams = state.selectedParams.filter(i => i !== idx);
                        div.classList.remove('selected');
                    }
                    document.getElementById('selection-error').classList.add('hidden');
                });

                container.appendChild(div);
            });
        }

        function startInterview() {
            state.candidateName = document.getElementById('candidate-name').value || 'Unnamed Candidate';

            if (state.selectedParams.length === 0) {
                document.getElementById('selection-error').classList.remove('hidden');
                return;
            }

            state.selectedParams.forEach(i => {
                state.starNotes[i] = { situation: '', task: '', action: '', result: '' };
                state.ratings[i] = null;
            });

            state.currentIndex = 0;
            showScreen('interview');
            updateInterviewScreen();
        }

        function updateInterviewScreen() {
            const paramIdx = state.selectedParams[state.currentIndex];
            const param = state.parameters[paramIdx];

            document.getElementById('interview-param-name').textContent = param.name;
            document.getElementById('interview-param-desc').textContent = param.description;
            document.getElementById('interview-question').textContent = param.question;

            // Render levels
            const levelsHtml = `
                <div class="level-item">
                    <div class="level-badge">1</div>
                    <div>
                        <div class="level-content-title">Needs Improvement</div>
                        <div class="level-content-desc">${escapeHtml(param.level1)}</div>
                    </div>
                </div>
                <div class="level-item">
                    <div class="level-badge">2</div>
                    <div>
                        <div class="level-content-title">Meets Expectations</div>
                        <div class="level-content-desc">${escapeHtml(param.level2)}</div>
                    </div>
                </div>
                <div class="level-item">
                    <div class="level-badge">3</div>
                    <div>
                        <div class="level-content-title">Exceeds Expectations</div>
                        <div class="level-content-desc">${escapeHtml(param.level3)}</div>
                    </div>
                </div>
                <div class="level-item">
                    <div class="level-badge">4</div>
                    <div>
                        <div class="level-content-title">Outstanding</div>
                        <div class="level-content-desc">${escapeHtml(param.level4)}</div>
                    </div>
                </div>
            `;
            document.getElementById('interview-levels').innerHTML = levelsHtml;

            // Restore notes
            const notes = state.starNotes[paramIdx];
            document.getElementById('situation').value = notes.situation;
            document.getElementById('task').value = notes.task;
            document.getElementById('action').value = notes.action;
            document.getElementById('result').value = notes.result;

            // Update progress
            const total = state.selectedParams.length;
            const progress = ((state.currentIndex + 1) / total) * 100;
            document.getElementById('interview-progress-bar').style.width = progress + '%';
            document.getElementById('interview-progress-text').textContent = `${state.currentIndex + 1} of ${total}`;

            document.getElementById('interview-prev').disabled = state.currentIndex === 0;
        }

        function saveInterviewNotes() {
            const paramIdx = state.selectedParams[state.currentIndex];
            state.starNotes[paramIdx] = {
                situation: document.getElementById('situation').value,
                task: document.getElementById('task').value,
                action: document.getElementById('action').value,
                result: document.getElementById('result').value
            };
        }

        function prevInterview() {
            saveInterviewNotes();
            if (state.currentIndex > 0) {
                state.currentIndex--;
                updateInterviewScreen();
            }
        }

        function nextInterview() {
            saveInterviewNotes();
            if (state.currentIndex < state.selectedParams.length - 1) {
                state.currentIndex++;
                updateInterviewScreen();
            } else {
                state.currentIndex = 0;
                showScreen('grading');
                updateGradingScreen();
            }
        }

        function updateGradingScreen() {
            const paramIdx = state.selectedParams[state.currentIndex];
            const param = state.parameters[paramIdx];
            const notes = state.starNotes[paramIdx];

            document.getElementById('grading-param-name').textContent = param.name;
            document.getElementById('grading-param-desc').textContent = param.description;
            document.getElementById('grading-question').textContent = param.question;

            document.getElementById('review-situation').textContent = notes.situation || '-';
            document.getElementById('review-task').textContent = notes.task || '-';
            document.getElementById('review-action').textContent = notes.action || '-';
            document.getElementById('review-result').textContent = notes.result || '-';

            // Render ratings
            const ratingsHtml = `
                <label class="radio-item">
                    <input type="radio" name="rating" value="1" style="accent-color: var(--primary);">
                    <div class="radio-label">
                        <span class="radio-label-title">1 â€” Needs Improvement</span>
                        <span class="radio-label-desc">${escapeHtml(param.level1)}</span>
                    </div>
                </label>
                <label class="radio-item">
                    <input type="radio" name="rating" value="2" style="accent-color: var(--primary);">
                    <div class="radio-label">
                        <span class="radio-label-title">2 â€” Meets Expectations</span>
                        <span class="radio-label-desc">${escapeHtml(param.level2)}</span>
                    </div>
                </label>
                <label class="radio-item">
                    <input type="radio" name="rating" value="3" style="accent-color: var(--primary);">
                    <div class="radio-label">
                        <span class="radio-label-title">3 â€” Exceeds Expectations</span>
                        <span class="radio-label-desc">${escapeHtml(param.level3)}</span>
                    </div>
                </label>
                <label class="radio-item">
                    <input type="radio" name="rating" value="4" style="accent-color: var(--primary);">
                    <div class="radio-label">
                        <span class="radio-label-title">4 â€” Outstanding</span>
                        <span class="radio-label-desc">${escapeHtml(param.level4)}</span>
                    </div>
                </label>
            `;
            document.getElementById('grading-ratings').innerHTML = ratingsHtml;

            // Restore rating
            const rating = state.ratings[paramIdx];
            if (rating) {
                document.querySelector(`input[name="rating"][value="${rating}"]`).checked = true;
            }

            // Update progress
            const total = state.selectedParams.length;
            const progress = ((state.currentIndex + 1) / total) * 100;
            document.getElementById('grading-progress-bar').style.width = progress + '%';
            document.getElementById('grading-progress-text').textContent = `${state.currentIndex + 1} of ${total}`;

            document.getElementById('grading-prev').disabled = state.currentIndex === 0;
            document.getElementById('grading-next').textContent = state.currentIndex < total - 1 ? 'Next Parameter' : 'Complete Assessment';
            document.getElementById('rating-error').classList.add('hidden');
        }

        function prevGrading() {
            saveGradingRating();
            if (state.currentIndex > 0) {
                state.currentIndex--;
                updateGradingScreen();
            }
        }

        function nextGrading() {
            const checked = document.querySelector('input[name="rating"]:checked');
            if (!checked) {
                document.getElementById('rating-error').classList.remove('hidden');
                return;
            }

            saveGradingRating();

            if (state.currentIndex < state.selectedParams.length - 1) {
                state.currentIndex++;
                updateGradingScreen();
            } else {
                showScreen('results');
                renderResults();
            }
        }

        function saveGradingRating() {
            const paramIdx = state.selectedParams[state.currentIndex];
            const checked = document.querySelector('input[name="rating"]:checked');
            if (checked) {
                state.ratings[paramIdx] = parseInt(checked.value);
            }
        }

        function renderResults() {
            // Calculate scores
            let total = 0;
            let count = 0;

            state.selectedParams.forEach(i => {
                if (state.ratings[i]) {
                    total += state.ratings[i];
                    count++;
                }
            });

            const avg = count > 0 ? (total / count).toFixed(1) : 0;
            document.getElementById('results-score').textContent = avg;
            document.getElementById('results-candidate').textContent = state.candidateName;

            // Recommendation
            let rec = '';
            if (avg >= 3.5) rec = 'Strong Hire';
            else if (avg >= 3.0) rec = 'Hire';
            else if (avg >= 2.5) rec = 'Conditional Hire';
            else if (avg >= 2.0) rec = 'Proceed with Caution';
            else rec = 'Do Not Hire';

            document.getElementById('results-recommendation').textContent = rec;

            // Scores
            let scoresHtml = '';
            state.selectedParams.forEach(i => {
                const p = state.parameters[i];
                const r = state.ratings[i] || 0;
                const pct = (r / 4) * 100;
                scoresHtml += `
                    <div class="score-card">
                        <div class="score-card-header">
                            <div class="score-card-title">${escapeHtml(p.name)}</div>
                            <div class="score-card-value">${r}/4</div>
                        </div>
                        <div class="progress-bar-track">
                            <div class="progress-bar-fill" style="width: ${pct}%"></div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('results-scores').innerHTML = scoresHtml;

            // Responses
            let respHtml = '';
            state.selectedParams.forEach(i => {
                const p = state.parameters[i];
                const n = state.starNotes[i];
                const r = state.ratings[i] || 0;
                respHtml += `
                    <div class="response-item">
                        <div class="response-item-title">${escapeHtml(p.name)}</div>
                        <div class="response-item-row">
                            <div>
                                <div class="response-field-label">Question</div>
                                <div class="response-field-value">${escapeHtml(p.question)}</div>
                            </div>
                            <div>
                                <div class="response-field-label">Rating</div>
                                <div class="response-field-value" style="font-weight: 600; color: var(--primary);">${r}/4</div>
                            </div>
                        </div>
                        <div class="response-item-row">
                            <div>
                                <div class="response-field-label">Situation</div>
                                <div class="response-field-value">${escapeHtml(n.situation || '-')}</div>
                            </div>
                            <div>
                                <div class="response-field-label">Task</div>
                                <div class="response-field-value">${escapeHtml(n.task || '-')}</div>
                            </div>
                        </div>
                        <div class="response-item-row">
                            <div>
                                <div class="response-field-label">Action</div>
                                <div class="response-field-value">${escapeHtml(n.action || '-')}</div>
                            </div>
                            <div>
                                <div class="response-field-label">Result</div>
                                <div class="response-field-value">${escapeHtml(n.result || '-')}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('results-responses').innerHTML = respHtml;
        }

        function showScreen(name) {
            Object.values(screens).forEach(s => s.classList.add('hidden'));
            screens[name].classList.remove('hidden');

            if (name === 'selection') {
                renderParameterSelection();
            }
        }

        function showError(msg) {
            const err = document.getElementById('error-message');
            err.textContent = msg;
            err.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error-message').classList.add('hidden');
        }

        function resetUpload() {
            state.parameters = [];
            state.selectedParams = [];
            document.getElementById('file-input').value = '';
            document.getElementById('preview-section').style.display = 'none';
            hideError();
            showScreen('upload');
        }

        function restart() {
            state.selectedParams = [];
            state.candidateName = '';
            state.currentIndex = 0;
            state.starNotes = {};
            state.ratings = {};
            document.getElementById('candidate-name').value = '';
            showScreen('selection');
            renderParameterSelection();
        }

        function printResults() {
            window.print();
        }

        function savePDF() {
            const element = document.getElementById('screen-results');
            const opt = {
                margin: 10,
                filename: `BARS_Assessment_${state.candidateName.replace(/\s+/g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
